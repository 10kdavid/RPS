"use strict";(()=>{var e={};e.id=494,e.ids=[494],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},781:(e,r,t)=>{t.r(r),t.d(r,{config:()=>d,default:()=>u,routeModule:()=>f});var o={};t.r(o),t.d(o,{default:()=>c});var s=t(1802),n=t(7153),a=t(6249);let i="sk_production_5YcBgonNBeEhyGBnWLbzgQU1hbJsxtr1GGuX8wSE1M6CgS2q5NuFJc25b5Pn3VXjn9WEj6HwKb65NKJgKV3NuvwQgLx84wpRt5dESVTh24svfFnyzHSNyx9eg1TZpLAHiyAFizeHNTTretuhbkg8AewfS4Qx5QrgoBoRjdsN1qvq3HDvRoNNv66yoKaTQafUoeGievHp8bMPLT1arB2EWsZf",l="https://www.crossmint.com/api";async function c(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{escrowAddress:t,winnerAddress:o,amount:s,gameId:n}=e.body;if(!t||!o||!s||!n)return r.status(400).json({error:"Missing required fields",message:"escrowAddress, winnerAddress, amount, and gameId are required"});console.log(`Processing escrow release for game ${n}: ${s} SOL from ${t} to ${o}`);let a=await fetch(`${l}/v1-alpha2/wallets/${t}/balances?tokens=sol&chains=solana-mainnet`,{headers:{"X-API-KEY":i,"Content-Type":"application/json"}});if(!a.ok)return r.status(500).json({error:"Failed to get escrow balance",details:await a.text()});let c=await a.json();console.log("Escrow balance response:",c);let u=c.balances?.find(e=>"sol"===e.token.toLowerCase());if(!u||0>=parseFloat(u.amount))return r.status(400).json({error:"Insufficient escrow balance",amount:u?.amount||0});let d=await fetch(`${l}/v1-alpha2/wallets/${t}/transactions`,{method:"POST",headers:{"X-API-KEY":i,"Content-Type":"application/json"},body:JSON.stringify({type:"transfer",toAddress:o,token:"sol",amount:s,chain:"solana-mainnet"})});if(!d.ok){let e=await d.text();return console.error(`Failed to release escrow for game ${n}:`,e),r.status(500).json({error:"Failed to release escrow funds",details:e})}let f=await d.json();return console.log(`Successfully released escrow for game ${n}:`,f),r.status(200).json({success:!0,gameId:n,winner:o,amount:s,transaction:f})}catch(e){return console.error("Error processing escrow release:",e),r.status(500).json({error:"Internal server error",message:e instanceof Error?e.message:"Unknown error"})}}let u=(0,a.l)(o,"default"),d=(0,a.l)(o,"config"),f=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/crossmint/escrow/release",pathname:"/api/crossmint/escrow/release",bundlePath:"",filename:""},userland:o})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=781);module.exports=t})();